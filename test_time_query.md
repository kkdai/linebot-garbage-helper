# 時間查詢功能測試指南

## 🕐 新增的時間查詢功能說明

### 功能改進

1. **智慧時間解析**：透過 Gemini AI 分析用戶的自然語言時間查詢
2. **收藏地點整合**：當沒有指定地址時，會提示使用收藏地點
3. **友善的互動體驗**：提供清楚的指引和選項

### 支援的查詢方式

#### 1. 完整的時間+地點查詢
- 輸入：「我晚上七點前在台北市大安區哪裡倒垃圾？」
- 行為：直接查詢台北市大安區晚上7點前的垃圾車

#### 2. 時間查詢（無具體地點）
- 輸入：「我晚上七點前在哪裡倒垃圾？」
- 行為：系統會提示用戶：
  - 分享即時位置，或
  - 輸入具體地址，或
  - 使用收藏地點（如果有的話）

#### 3. 收藏地點 + 時間查詢
- 先收藏地點：`/favorite 家 台北市信義區忠孝東路100號`
- 然後輸入：「家」或收藏地點名稱
- 系統會自動使用收藏地點進行查詢

### 測試案例

#### 測試案例 1：時間查詢無地點
```
用戶輸入：「我晚上七點前在哪裡倒垃圾？」

預期回應：
🕐 您想查詢19:00前的垃圾車資訊

請提供位置資訊：
📍 分享您的即時位置，或
💬 輸入具體地址

💡 您也可以使用 `/favorite 家 台北市大安區xxx` 來收藏常用地點
```

#### 測試案例 2：有收藏地點的時間查詢
```
前提：用戶已收藏地點「家」

用戶輸入：「我晚上七點前在哪裡倒垃圾？」

預期回應：
🕐 您想查詢19:00前的垃圾車資訊

您可以：
📍 分享您的即時位置
❤️ 選擇收藏地點：
• 家

請分享位置或輸入收藏地點名稱
```

#### 測試案例 3：直接使用收藏地點名稱
```
前提：用戶已收藏地點「家」

用戶輸入：「家」

預期行為：
- 系統找到收藏地點「家」
- 直接查詢該地點附近的垃圾車
- 顯示垃圾車結果
```

#### 測試案例 4：收藏地點 + 時間查詢
```
前提：用戶已收藏地點「公司」

用戶輸入：「公司 晚上六點前」

預期行為：
- 系統識別「公司」為收藏地點
- 同時解析時間「晚上六點前」
- 查詢公司地點晚上6點前的垃圾車
```

## 🔧 如何測試

### 1. 部署最新版本
```bash
git add .
git commit -m "feat: implement time query without location"
git push origin main
```

### 2. 測試步驟
1. 在 LINE 中先設定收藏地點：
   ```
   /favorite 家 [你的地址]
   ```

2. 測試各種時間查詢：
   - 「我晚上七點前在哪裡倒垃圾？」
   - 「我明天早上八點後哪裡有垃圾車？」
   - 「家」
   - 「家 晚上六點前」

3. 檢查系統回應是否符合預期

### 3. 檢查日誌
```bash
gcloud logs read "resource.type=cloud_run_revision AND resource.labels.service_name=garbage-linebot AND textPayload:~'Time window'" --limit=20
```

## 🚀 預期效果

- **更自然的查詢體驗**：用戶可以用自然語言詢問時間相關問題
- **智慧地點管理**：結合收藏地點功能，提供便利的查詢方式  
- **清楚的互動指引**：當資訊不足時，提供明確的下一步指示
- **高效的查詢流程**：減少用戶重複輸入地址的需求

## 🔍 故障排除

如果功能沒有正常運作，檢查：

1. **Gemini API 配額**：確認 API 調用次數沒有超限
2. **時間解析**：檢查 `ParseTimeWindow` 函數是否正確解析時間
3. **收藏地點**：確認用戶有正確設定收藏地點
4. **日誌檢查**：查看 Cloud Run 日誌中的錯誤訊息